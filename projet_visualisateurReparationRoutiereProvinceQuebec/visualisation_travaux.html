<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Visualisation des Travaux Routiers - Qu√©bec</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f0f2f5;
        }
        #header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #header h1 {
            font-size: 28px;
            margin-bottom: 5px;
        }
        #header p {
            font-size: 14px;
            opacity: 0.9;
        }
        #container {
            display: flex;
            height: calc(100vh - 100px);
        }
        #sidebar {
            width: 400px;
            background: white;
            overflow-y: auto;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
            padding: 20px;
        }
        #map {
            flex: 1;
        }
        .reparation-card {
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .reparation-card:hover {
            border-color: #667eea;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
            transform: translateY(-2px);
        }
        .reparation-card.active {
            border-color: #667eea;
            background: #f8f9ff;
        }
        .card-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .route-badge {
            background: #667eea;
            color: white;
            padding: 5px 12px;
            border-radius: 20px;
            font-weight: bold;
            font-size: 14px;
            margin-right: 10px;
        }
        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            flex: 1;
        }
        .card-info {
            font-size: 13px;
            color: #666;
            margin: 8px 0;
            line-height: 1.6;
        }
        .card-info strong {
            color: #333;
            display: block;
            margin-bottom: 3px;
        }
        .entrave-badge {
            background: #ff6b6b;
            color: white;
            padding: 4px 10px;
            border-radius: 5px;
            font-size: 12px;
            display: inline-block;
            margin-top: 8px;
        }
        .leaflet-popup-content {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .popup-title {
            font-weight: bold;
            font-size: 16px;
            color: #667eea;
            margin-bottom: 10px;
        }
        .popup-info {
            font-size: 13px;
            margin: 5px 0;
            line-height: 1.5;
        }
    </style>
</head>
<body>
    <div id="header">
        <h1>üöß Travaux Routiers au Qu√©bec</h1>
        <p>Visualisation de 3 chantiers routiers actifs</p>
    </div>
    <div id="container">
        <div id="sidebar">
            <div id="reparations-list"></div>
        </div>
        <div id="map"></div>
    </div>

    <script>
        // Donn√©es des r√©parations
        const reparations = [
            {
                "id": "206220",
                "route": "25",
                "type_travaux": "Projet de r√©fection du tunnel Louis-Hippolyte-La Fontaine",
                "localisation": "√Ä Montr√©al (Mercier-Hochelaga-Maisonneuve)\nLa sortie 4 (avenue Souligny, centre-ville)",
                "direction": "Sud et nord",
                "entrave": "Largeur de voie : 4,5 m√®tres",
                "debut": "2022/10/31 00:00:00",
                "fin": "2025/12/31 00:00:00",
                "detours": "",
                "geometry": {
                    "type": "LineString",
                    "coordinates": [[-73.52996, 45.591768], [-73.529601, 45.591671], [-73.52907, 45.5915]]
                },
                "bbox": [-73.52996, 45.5915, -73.52907, 45.591768]
            },
            {
                "id": "306154",
                "route": "301",
                "type_travaux": "Travaux d'inspection",
                "localisation": "√Ä Portage-du-Fort, sur le chemin de l'√éle, au-dessus de la rivi√®re des Outaouais",
                "direction": "Sud et nord",
                "entrave": "Circulation en alternance, dimanche, entre 8 h et 18 h",
                "debut": "2025/10/05 08:00:00",
                "fin": "2025/10/05 18:00:00",
                "detours": "",
                "geometry": {
                    "type": "LineString",
                    "coordinates": [[-76.670542, 45.586599], [-76.671451, 45.584991]]
                },
                "bbox": [-76.671451, 45.584991, -76.670542, 45.586599]
            },
            {
                "id": "305836",
                "route": "",
                "type_travaux": "Hydro-Qu√©bec",
                "localisation": "√Ä Montr√©al, sur voie de desserte, entre rue Houde et av. Sainte-Croix",
                "direction": "Ouest",
                "entrave": "Fermeture de 2 voies sur 4 \nDe vendredi 22 h √† lundi 5 h",
                "debut": "2025/10/03 22:00:00",
                "fin": "2025/10/06 05:00:00",
                "detours": "",
                "geometry": {
                    "type": "LineString",
                    "coordinates": [[-73.659205, 45.51429], [-73.659138, 45.514271], [-73.659439, 45.513812], [-73.660339, 45.51234], [-73.661665, 45.510306], [-73.662421, 45.509122], [-73.66268, 45.508692], [-73.66277, 45.508573], [-73.662832, 45.508491], [-73.663105, 45.508058]]
                },
                "bbox": [-73.663105, 45.508058, -73.659138, 45.51429]
            }
        ];

        // Initialiser la carte centr√©e sur Montr√©al
        const map = L.map('map').setView([45.5, -73.6], 9);

        // Ajouter le fond de carte
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '¬© OpenStreetMap contributors'
        }).addTo(map);

        // Stocker les layers pour pouvoir les manipuler
        const layers = {};

        // Fonction pour cr√©er les cartes dans la sidebar
        function createSidebarCards() {
            const container = document.getElementById('reparations-list');

            reparations.forEach((rep, index) => {
                const card = document.createElement('div');
                card.className = 'reparation-card';
                card.id = `card-${rep.id}`;

                card.innerHTML = `
                    <div class="card-header">
                        <div class="route-badge">${rep.route || 'N/A'}</div>
                        <div class="card-title">${rep.type_travaux}</div>
                    </div>
                    <div class="card-info">
                        <strong>üìç Localisation:</strong>
                        ${rep.localisation.split('\n')[0]}
                    </div>
                    <div class="card-info">
                        <strong>üß≠ Direction:</strong> ${rep.direction}
                    </div>
                    <div class="card-info">
                        <strong>üìÖ P√©riode:</strong>
                        ${rep.debut.split(' ')[0]} ‚Üí ${rep.fin.split(' ')[0]}
                    </div>
                    <div class="entrave-badge">üöß ${rep.entrave.split('\n')[0]}</div>
                `;

                card.addEventListener('click', () => {
                    // Retirer la classe active de toutes les cartes
                    document.querySelectorAll('.reparation-card').forEach(c => c.classList.remove('active'));
                    // Ajouter la classe active √† la carte cliqu√©e
                    card.classList.add('active');
                    // Zoomer sur la r√©paration
                    const layer = layers[rep.id];
                    map.fitBounds(layer.getBounds(), { padding: [50, 50] });
                    layer.openPopup();
                });

                container.appendChild(card);
            });
        }

        // Fonction pour ajouter les r√©parations sur la carte
        function addReparationsToMap() {
            reparations.forEach(rep => {
                // Inverser les coordonn√©es pour Leaflet (lat, lng au lieu de lng, lat)
                const coords = rep.geometry.coordinates.map(coord => [coord[1], coord[0]]);

                // Cr√©er la ligne
                const polyline = L.polyline(coords, {
                    color: '#FF6A33',
                    weight: 5,
                    opacity: 0.8
                }).addTo(map);

                // Cr√©er le popup
                const popupContent = `
                    <div class="popup-title">${rep.type_travaux}</div>
                    <div class="popup-info"><strong>Route:</strong> ${rep.route || 'N/A'}</div>
                    <div class="popup-info"><strong>Localisation:</strong><br>${rep.localisation.replace(/\n/g, '<br>')}</div>
                    <div class="popup-info"><strong>Direction:</strong> ${rep.direction}</div>
                    <div class="popup-info"><strong>Entrave:</strong><br>${rep.entrave.replace(/\n/g, '<br>')}</div>
                    <div class="popup-info"><strong>P√©riode:</strong><br>${rep.debut.split(' ')[0]} ‚Üí ${rep.fin.split(' ')[0]}</div>
                `;

                polyline.bindPopup(popupContent, { maxWidth: 300 });

                // Ajouter un marker au d√©but de la ligne
                L.circleMarker(coords[0], {
                    radius: 8,
                    fillColor: '#667eea',
                    color: 'white',
                    weight: 2,
                    opacity: 1,
                    fillOpacity: 0.9
                }).addTo(map).bindPopup(popupContent, { maxWidth: 300 });

                // Stocker le layer
                layers[rep.id] = polyline;
            });
        }

        // Initialiser l'interface
        createSidebarCards();
        addReparationsToMap();

        // Ajuster la vue pour montrer toutes les r√©parations
        const allCoords = reparations.flatMap(rep =>
            rep.geometry.coordinates.map(coord => [coord[1], coord[0]])
        );
        const bounds = L.latLngBounds(allCoords);
        map.fitBounds(bounds, { padding: [50, 50] });
    </script>
</body>
</html>
